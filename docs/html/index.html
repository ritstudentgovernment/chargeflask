<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Charge Tracker: Charge Tracker Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="80px.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Charge Tracker
   </div>
   <div id="projectbrief">Charge tracking platform for RIT Student Government.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Charge Tracker Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#gettingstarted">Getting Started</a><ul><li class="level2"><a href="#serverinstall">Server Installation</a></li>
<li class="level2"><a href="#testutil">Testing Utilities</a></li>
</ul>
</li>
<li class="level1"><a href="#datamani">Data Manipulation</a><ul><li class="level2"><a href="#submitData">Submitting Data</a></li>
<li class="level2"><a href="#retrieveData">Retrieving Data</a></li>
</ul>
</li>
<li class="level1"><a href="#modulestruct">Module Structure</a></li>
<li class="level1"><a href="#unittests">Unit Tests and Code Coverage</a></li>
</ul>
</div>
<div class="textblock"><p>This is the documentation for the <a href="https://github.com/ritstudentgovernment/chargeflask">ChargeTracker</a> backend, the front-end documentation is located in the <a href="https://github.com/ritstudentgovernment/chargevue">chargevue</a> repository.</p>
<h1><a class="anchor" id="gettingstarted"></a>
Getting Started</h1>
<p>This guide contains step-by-step instructions on how to install the server, how to get data to the backend and how to get data from it.</p>
<h2><a class="anchor" id="serverinstall"></a>
Server Installation</h2>
<p>Prerequisites: Flask and PostgreSQL</p><ol type="1">
<li>Pull project from <a href="https://github.com/ritstudentgovernment/chargeflask">this repo</a>.</li>
<li>Install and create <a href="http://python-guide-pt-br.readthedocs.io/en/latest/dev/virtualenvs/">virtual environment</a>.</li>
<li>Create a database for the project.</li>
<li>Specify the <code>SQLALCHEMY_DATABASE_URI</code> in the <code>config.py</code> file with the database path.</li>
<li>Activate virtual environment.</li>
<li>ExecuteÂ <code>pip install -r requirements.txt</code></li>
<li>Complete the <code>secrets.py</code> file (Contact System Administrator for relevant data).</li>
<li>Run <code>python run.py</code></li>
</ol>
<h2><a class="anchor" id="testutil"></a>
Testing Utilities</h2>
<p>In some cases, you'd like to test if your backend code is properly working. But, because you don't have access to a frontend yet, it might seem quite hard to test your code while developing it. For this, it's recommended to install in your machine a tool called <a href="https://electronjs.org/apps/socket-io-tester">Socket.io tester</a>, which let's so send and retrieve data from the backend without the need of a developed client.</p>
<h1><a class="anchor" id="datamani"></a>
Data Manipulation</h1>
<p>ChargeTracker uses a technology called <a href="https://socket.io/">SocketIO</a>, which basically provides real-time communication between two different machines through WebSockets. SocketIO allows the easy implementation of WebSockets cross-platform and cross-language. For example, the <a href="https://github.com/ritstudentgovernment/chargevue">chargevue</a> client for this application, uses the native Javascript SocketIO library, meanwhile this backend utilizes the Flask library <a href="https://flask-socketio.readthedocs.io/en/latest/">Flask-SocketIO</a>. Bellow, there are a few detailed examples on how to request or submit data to and from the ChargeTracker backend.</p>
<h2><a class="anchor" id="submitData"></a>
Submitting Data</h2>
<p>Submitting data to ChargeTracker is very simple. Basically, inside each the controllers file of each module there are certain functions that <em>listen</em> for data in a specific event name. For example, inside the controllers of the Committees module, we can see the <code>get_commitees</code> method:</p>
<div class="fragment"><div class="line">##</div><div class="line">##  Gets list of all committees.</div><div class="line">##</div><div class="line">##@param broadcast  Flag to broadcast list of committees to all users.</div><div class="line">##</div><div class="line">## @emit       Emits a list of committees.</div><div class="line">##</div><div class="line">@socketio.on(&#39;get_committees&#39;)</div><div class="line">def get_committees(broadcast = False):</div><div class="line">    committees = Committees.query.filter_by(enabled = True).all()</div><div class="line">    comm_ser = [{&quot;id&quot;: c.id, &quot;title&quot;: c.title} for c in committees]</div><div class="line">    emit(&quot;get_committees&quot;, comm_ser, broadcast= broadcast)</div></div><!-- fragment --><p>We can see that every method inside the controllers start with the line &lsquo;.on(&rsquo;&lt;event_name&gt;')<code>, this basically means that once the server listens to a request in that specific event, the function under it will be executed. In this case, when a person sends a request with the event</code>get_committees` to the server, the function get_committees will be executed.</p>
<p>To send this request to the server, the request can be written in the following way:</p>
<div class="fragment"><div class="line">// Javascript Socket-IO request.</div><div class="line">var socket = io.connect(&#39;http://localhost:5000&#39;);</div><div class="line">socket.emit(&#39;get_committees&#39;);</div></div><!-- fragment --><p>We can also notice that the <code>get_committees</code> method gets the parameter broadcast, which basically broadcasts the list of committees to all the users listening, to send data to the server, you can send a JSON object or a String.</p>
<p>For example, if I want my request of committees to be broadcasted to everyone that is listening to <code>get_committees</code>, I can do:</p>
<div class="fragment"><div class="line">// Javascript Socket-IO request with params.</div><div class="line">var socket = io.connect(&#39;http://localhost:5000&#39;);</div><div class="line">socket.emit(&#39;get_committees&#39;, true);</div></div><!-- fragment --><h2><a class="anchor" id="retrieveData"></a>
Retrieving Data</h2>
<p><b>IMPORTANT</b>: Also take into account that to receive this data, you have to be listening to the events with the same event_name. So, if I'd like to receive all the committees, you have to listen to the <code>get_committees</code> event name:</p>
<div class="fragment"><div class="line">// Javascript Socket-IO listener.</div><div class="line">var socket = io.connect(&#39;http://localhost:5000&#39;);</div><div class="line">socket.on(&#39;get_committees&#39;, function(data){</div><div class="line">    console.log(data);</div><div class="line">});</div></div><!-- fragment --><p>These channels are always open, so you only have to listen to data once and you'll keep receiving new data as it becomes available, without having to create new requests!</p>
<h1><a class="anchor" id="modulestruct"></a>
Module Structure</h1>
<p>To keep the source code organized, each functionality of <a href="https://github.com/ritstudentgovernment/chargeflask">ChargeTracker</a> is divided in different modules. For example, the Users module contains everything relevant to user authentication, meanwhile the Committees module has everything relevant to manipulating committees.</p>
<p>Every module in ChargeTracker contains the following files:</p>
<ul>
<li><code>__init__.py</code> (required): This file is usually empty, its necessary to create a Python module.</li>
<li><code>models.py</code> (required): This file contains the model declaration of the module itself. This usually contains the SQLAlchemy model declaration.</li>
<li><code>controllers.py</code> (required): This file contains all the relevant controllers to manipulate data on the server, please refer to the examples on the <a href="#datamani">Data Manipulation</a> section.</li>
<li><code>test_&lt;module_name&gt;.py</code> (required): This file contains all the test cases for this specific module, please refer to the examples on the Testing Modules section.</li>
<li><code>&lt;module_name&gt;_response.py</code>: Instead of hard-coding response strings inside the controllers class, all the response strings specific to this module are located inside this class. In the future, this will allow the easy implementation of <a href="https://github.com/ritstudentgovernment/chargeflask">ChargeTracker</a> in a different language.</li>
</ul>
<h1><a class="anchor" id="unittests"></a>
Unit Tests and Code Coverage</h1>
<p>Every module in this project is unit tested to check if the code implemented is fully functional. For unit testing, ChargeTracker utilizes the Python testing utility, <a href="https://docs.pytest.org">pytest</a>. To execute your unit tests locally, you can simply run the command: <code>py.test --cov=./app</code>, if you want to generate a html coverage report, the same command can be executed with the flag <code>--cov-report=html</code>. For code coverage, this project uses <a href="https://travis-ci.org/">TravisCI</a> and <a href="https://codecov.io/gh">Codecov</a>, the TravisCI .yml file is located under <code>.travis.yml</code>, which basically contains the configuration that Travis needs to execute your code. Also, take into account that TravisCI needs a copy of your <code>secrets.py</code> to execute your code, this is done by encrypting your secrets file with TravisCI. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
